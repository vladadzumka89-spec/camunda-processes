<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Web Modeler" exporterVersion="e787c33" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.8.0">

  <bpmn:process id="Process_vyplata_avansu" name="Виплата авансу по підрозділу" isExecutable="true">

    <!-- ============================================ -->
    <!-- START EVENT                                   -->
    <!-- ============================================ -->
    <bpmn:startEvent id="StartEvent_1" name="Старт процесу">
      <bpmn:outgoing>Flow_start_to_gw1</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- ============================================ -->
    <!-- XOR GATEWAY: перевірка odoo_task_id (правило #1) -->
    <!-- ============================================ -->
    <bpmn:exclusiveGateway id="Gateway_check_task" name="Завдання вже створено?" default="Flow_gw1_to_create_task">
      <bpmn:incoming>Flow_start_to_gw1</bpmn:incoming>
      <bpmn:outgoing>Flow_gw1_to_create_task</bpmn:outgoing>
      <bpmn:outgoing>Flow_gw1_skip</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ============================================ -->
    <!-- SERVICE TASK: Створити головне завдання (правило #2) -->
    <!-- ============================================ -->
    <bpmn:serviceTask id="Task_create_main" name="Створити головне завдання &#34;Виплата авансу по підрозділу&#34;">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Виплата авансу по підрозділу&#34;, create_process: true, _model: &#34;project.project&#34;, _id: 252}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_gw1_to_create_task</bpmn:incoming>
      <bpmn:outgoing>Flow_create_to_merge</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- MERGE GATEWAY після створення завдання -->
    <bpmn:exclusiveGateway id="Gateway_merge1">
      <bpmn:incoming>Flow_create_to_merge</bpmn:incoming>
      <bpmn:incoming>Flow_gw1_skip</bpmn:incoming>
      <bpmn:outgoing>Flow_merge1_to_get_employees</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ============================================ -->
    <!-- SERVICE TASK: Отримати список працівників (правило #4) -->
    <!-- ============================================ -->
    <bpmn:serviceTask id="Task_get_employees" name="Отримати список працівників підрозділу">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/api/server-action&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;, &#34;X-API-Key&#34;:&#34;632b5ed6-091f-48db-bd01-1e60aeb10bfc&#34;}" target="headers" />
          <zeebe:input source="= {&#34;action_identifier&#34;: &#34;studio_customization._03c8968e-ba5a-43c9-839d-90197c29c03d&#34;, &#34;context&#34;: {}, &#34;payload&#34;: {&#34;groups&#34;: [600]}}" target="body" />
          <zeebe:input source="result" target="result_variable_name" />
          <zeebe:output source="= result.data" target="employees" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_merge1_to_get_employees</bpmn:incoming>
      <bpmn:outgoing>Flow_get_emp_to_approve</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ============================================ -->
    <!-- USER TASK: Погодити створення авансу (правило #3, #6) -->
    <!-- ============================================ -->
    <bpmn:userTask id="Task_approve" name="Погодити створення авансу по підрозділу">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Погодити створення авансу &#34; + emp.employee_name, description: &#34;Перегляньте та погодьте створення авансу по підрозділу&#34;, _model: &#34;project.project&#34;, _id: 252, x_studio_camunda_user_ids: emp.user_id, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_get_emp_to_approve</bpmn:incoming>
      <bpmn:incoming>Flow_adjust_to_approve</bpmn:incoming>
      <bpmn:outgoing>Flow_approve_to_gw2</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=employees" inputElement="emp" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:userTask>

    <!-- Boundary: Нагадування (non-interrupting) -->
    <bpmn:boundaryEvent id="Timer_approve_reminder" name="Нагадування" cancelActivity="false" attachedToRef="Task_approve">
      <bpmn:outgoing>Flow_approve_reminder</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_approve_reminder">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT24H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <!-- Service Task: Надіслати нагадування (для погодження) -->
    <bpmn:serviceTask id="Task_send_reminder_approve" name="Надіслати нагадування працівнику">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_approve_reminder</bpmn:incoming>
      <bpmn:outgoing>Flow_reminder_approve_end</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_reminder_approve">
      <bpmn:incoming>Flow_reminder_approve_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Boundary: Дедлайн (interrupting) -->
    <bpmn:boundaryEvent id="Timer_approve_deadline" name="Дедлайн прострочено" attachedToRef="Task_approve">
      <bpmn:outgoing>Flow_approve_deadline</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_approve_deadline">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P3D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <!-- Subprocess: Ескалація (для погодження) -->
    <bpmn:subProcess id="SubProcess_escalation_approve" name="Ескалація">
      <bpmn:incoming>Flow_approve_deadline</bpmn:incoming>
      <bpmn:outgoing>Flow_escalation_approve_end</bpmn:outgoing>
      <bpmn:startEvent id="Start_esc_approve" />
      <bpmn:endEvent id="End_esc_approve" />
    </bpmn:subProcess>

    <bpmn:endEvent id="End_escalation_approve" name="Ескалація завершена">
      <bpmn:incoming>Flow_escalation_approve_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ============================================ -->
    <!-- XOR GATEWAY: Погоджено?                       -->
    <!-- ============================================ -->
    <bpmn:exclusiveGateway id="Gateway_approved" name="Погоджено?" default="Flow_approved_no">
      <bpmn:incoming>Flow_approve_to_gw2</bpmn:incoming>
      <bpmn:outgoing>Flow_approved_yes</bpmn:outgoing>
      <bpmn:outgoing>Flow_approved_no</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ============================================ -->
    <!-- USER TASK: Скорегувати список працівників      -->
    <!-- ============================================ -->
    <bpmn:userTask id="Task_adjust" name="Скорегувати список працівників на виплату авансу">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Скорегувати список працівників на виплату авансу &#34; + emp.employee_name, description: &#34;Внесіть корективи до списку працівників для виплати авансу&#34;, _model: &#34;project.project&#34;, _id: 252, x_studio_camunda_user_ids: emp.user_id, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_approved_no</bpmn:incoming>
      <bpmn:outgoing>Flow_adjust_to_approve</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=employees" inputElement="emp" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:userTask>

    <!-- Boundary: Нагадування для корегування -->
    <bpmn:boundaryEvent id="Timer_adjust_reminder" name="Нагадування" cancelActivity="false" attachedToRef="Task_adjust">
      <bpmn:outgoing>Flow_adjust_reminder</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_adjust_reminder">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT24H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="Task_send_reminder_adjust" name="Надіслати нагадування працівнику">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_adjust_reminder</bpmn:incoming>
      <bpmn:outgoing>Flow_reminder_adjust_end</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_reminder_adjust">
      <bpmn:incoming>Flow_reminder_adjust_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Boundary: Дедлайн для корегування -->
    <bpmn:boundaryEvent id="Timer_adjust_deadline" name="Дедлайн прострочено" attachedToRef="Task_adjust">
      <bpmn:outgoing>Flow_adjust_deadline</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_adjust_deadline">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P3D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:subProcess id="SubProcess_escalation_adjust" name="Ескалація">
      <bpmn:incoming>Flow_adjust_deadline</bpmn:incoming>
      <bpmn:outgoing>Flow_escalation_adjust_end</bpmn:outgoing>
      <bpmn:startEvent id="Start_esc_adjust" />
      <bpmn:endEvent id="End_esc_adjust" />
    </bpmn:subProcess>

    <bpmn:endEvent id="End_escalation_adjust" name="Ескалація завершена">
      <bpmn:incoming>Flow_escalation_adjust_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ============================================ -->
    <!-- TIMER: Очікування дня виплати авансу           -->
    <!-- ============================================ -->
    <bpmn:intermediateCatchEvent id="Timer_wait_payday" name="Очікування дня виплати авансу">
      <bpmn:incoming>Flow_approved_yes</bpmn:incoming>
      <bpmn:outgoing>Flow_wait_to_fill</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_wait_payday">
        <bpmn:timeDate xsi:type="bpmn:tFormalExpression">= x_studio_camunda_payment_date</bpmn:timeDate>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>

    <!-- ============================================ -->
    <!-- USER TASK: Заповнити дані для виплати (правило #3, #6) -->
    <!-- ============================================ -->
    <bpmn:userTask id="Task_fill_data" name="Заповнити дані для виплати авансу">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Заповнити дані для виплати авансу &#34; + emp.employee_name, description: &#34;Заповніть дані для виплати авансу працівнику&#34;, _model: &#34;project.project&#34;, _id: 252, x_studio_camunda_user_ids: emp.user_id, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_wait_to_fill</bpmn:incoming>
      <bpmn:outgoing>Flow_fill_to_create_statement</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=employees" inputElement="emp" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:userTask>

    <!-- Boundary: Нагадування для заповнення -->
    <bpmn:boundaryEvent id="Timer_fill_reminder" name="Нагадування" cancelActivity="false" attachedToRef="Task_fill_data">
      <bpmn:outgoing>Flow_fill_reminder</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_fill_reminder">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT24H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="Task_send_reminder_fill" name="Надіслати нагадування працівнику">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_fill_reminder</bpmn:incoming>
      <bpmn:outgoing>Flow_reminder_fill_end</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="End_reminder_fill">
      <bpmn:incoming>Flow_reminder_fill_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- Boundary: Дедлайн для заповнення -->
    <bpmn:boundaryEvent id="Timer_fill_deadline" name="Дедлайн прострочено" attachedToRef="Task_fill_data">
      <bpmn:outgoing>Flow_fill_deadline</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_fill_deadline">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P3D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:subProcess id="SubProcess_escalation_fill" name="Ескалація">
      <bpmn:incoming>Flow_fill_deadline</bpmn:incoming>
      <bpmn:outgoing>Flow_escalation_fill_end</bpmn:outgoing>
      <bpmn:startEvent id="Start_esc_fill" />
      <bpmn:endEvent id="End_esc_fill" />
    </bpmn:subProcess>

    <bpmn:endEvent id="End_escalation_fill" name="Ескалація завершена">
      <bpmn:incoming>Flow_escalation_fill_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ============================================ -->
    <!-- SERVICE TASK: Створити відомість               -->
    <!-- ============================================ -->
    <bpmn:serviceTask id="Task_create_statement" name="Створити відомість на виплату авансу">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Створити відомість на виплату авансу&#34;, _model: &#34;project.project&#34;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_fill_to_create_statement</bpmn:incoming>
      <bpmn:outgoing>Flow_statement_to_gw3</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ============================================ -->
    <!-- XOR GATEWAY: Є аванси до виплати?              -->
    <!-- ============================================ -->
    <bpmn:exclusiveGateway id="Gateway_has_advances" name="Є аванси до виплати?" default="Flow_no_advances">
      <bpmn:incoming>Flow_statement_to_gw3</bpmn:incoming>
      <bpmn:outgoing>Flow_has_advances</bpmn:outgoing>
      <bpmn:outgoing>Flow_no_advances</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ============================================ -->
    <!-- SERVICE TASK: Виплатити аванс                  -->
    <!-- ============================================ -->
    <bpmn:serviceTask id="Task_pay_advance" name="Виплатити аванс">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Виплатити аванс по підрозділу&#34;, _model: &#34;project.project&#34;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_has_advances</bpmn:incoming>
      <bpmn:outgoing>Flow_pay_to_rko</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ============================================ -->
    <!-- SERVICE TASK: Створити РКО в ЄРП               -->
    <!-- ============================================ -->
    <bpmn:serviceTask id="Task_create_rko" name="Створити РКО в ЄРП">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" />
        <zeebe:ioMapping>
          <zeebe:input source="= &#34;POST&#34;" target="method" />
          <zeebe:input source="= &#34;https://o.tut.ua/web/hook/8531324a-2785-48d1-8f4d-ddd66a267d50&#34;" target="url" />
          <zeebe:input source="= {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="= {name: &#34;Створити РКО в ЄРП&#34;, _model: &#34;project.project&#34;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_pay_to_rko</bpmn:incoming>
      <bpmn:outgoing>Flow_rko_to_end</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ============================================ -->
    <!-- END EVENTS                                    -->
    <!-- ============================================ -->
    <bpmn:endEvent id="EndEvent_done" name="Аванси по підрозділу виплачено">
      <bpmn:incoming>Flow_rko_to_end</bpmn:incoming>
    </bpmn:endEvent>

    <bpmn:endEvent id="EndEvent_no_advances" name="Немає авансів до виплати">
      <bpmn:incoming>Flow_no_advances</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ============================================ -->
    <!-- SEQUENCE FLOWS                                -->
    <!-- ============================================ -->
    <bpmn:sequenceFlow id="Flow_start_to_gw1" sourceRef="StartEvent_1" targetRef="Gateway_check_task" />
    <bpmn:sequenceFlow id="Flow_gw1_to_create_task" sourceRef="Gateway_check_task" targetRef="Task_create_main" />
    <bpmn:sequenceFlow id="Flow_gw1_skip" sourceRef="Gateway_check_task" targetRef="Gateway_merge1">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= is defined(odoo_task_id) and odoo_task_id != null</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_create_to_merge" sourceRef="Task_create_main" targetRef="Gateway_merge1" />
    <bpmn:sequenceFlow id="Flow_merge1_to_get_employees" sourceRef="Gateway_merge1" targetRef="Task_get_employees" />
    <bpmn:sequenceFlow id="Flow_get_emp_to_approve" sourceRef="Task_get_employees" targetRef="Task_approve" />
    <bpmn:sequenceFlow id="Flow_approve_to_gw2" sourceRef="Task_approve" targetRef="Gateway_approved" />
    <bpmn:sequenceFlow id="Flow_approved_yes" name="Так" sourceRef="Gateway_approved" targetRef="Timer_wait_payday">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= x_studio_camunda_approved = true</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_approved_no" name="Ні" sourceRef="Gateway_approved" targetRef="Task_adjust" />
    <bpmn:sequenceFlow id="Flow_adjust_to_approve" sourceRef="Task_adjust" targetRef="Task_approve" />
    <bpmn:sequenceFlow id="Flow_wait_to_fill" sourceRef="Timer_wait_payday" targetRef="Task_fill_data" />
    <bpmn:sequenceFlow id="Flow_fill_to_create_statement" sourceRef="Task_fill_data" targetRef="Task_create_statement" />
    <bpmn:sequenceFlow id="Flow_statement_to_gw3" sourceRef="Task_create_statement" targetRef="Gateway_has_advances" />
    <bpmn:sequenceFlow id="Flow_has_advances" name="Так" sourceRef="Gateway_has_advances" targetRef="Task_pay_advance">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">= x_studio_camunda_has_advances = true</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_no_advances" name="Ні" sourceRef="Gateway_has_advances" targetRef="EndEvent_no_advances" />
    <bpmn:sequenceFlow id="Flow_pay_to_rko" sourceRef="Task_pay_advance" targetRef="Task_create_rko" />
    <bpmn:sequenceFlow id="Flow_rko_to_end" sourceRef="Task_create_rko" targetRef="EndEvent_done" />

    <!-- Reminder flows -->
    <bpmn:sequenceFlow id="Flow_approve_reminder" sourceRef="Timer_approve_reminder" targetRef="Task_send_reminder_approve" />
    <bpmn:sequenceFlow id="Flow_reminder_approve_end" sourceRef="Task_send_reminder_approve" targetRef="End_reminder_approve" />
    <bpmn:sequenceFlow id="Flow_approve_deadline" sourceRef="Timer_approve_deadline" targetRef="SubProcess_escalation_approve" />
    <bpmn:sequenceFlow id="Flow_escalation_approve_end" sourceRef="SubProcess_escalation_approve" targetRef="End_escalation_approve" />

    <bpmn:sequenceFlow id="Flow_adjust_reminder" sourceRef="Timer_adjust_reminder" targetRef="Task_send_reminder_adjust" />
    <bpmn:sequenceFlow id="Flow_reminder_adjust_end" sourceRef="Task_send_reminder_adjust" targetRef="End_reminder_adjust" />
    <bpmn:sequenceFlow id="Flow_adjust_deadline" sourceRef="Timer_adjust_deadline" targetRef="SubProcess_escalation_adjust" />
    <bpmn:sequenceFlow id="Flow_escalation_adjust_end" sourceRef="SubProcess_escalation_adjust" targetRef="End_escalation_adjust" />

    <bpmn:sequenceFlow id="Flow_fill_reminder" sourceRef="Timer_fill_reminder" targetRef="Task_send_reminder_fill" />
    <bpmn:sequenceFlow id="Flow_reminder_fill_end" sourceRef="Task_send_reminder_fill" targetRef="End_reminder_fill" />
    <bpmn:sequenceFlow id="Flow_fill_deadline" sourceRef="Timer_fill_deadline" targetRef="SubProcess_escalation_fill" />
    <bpmn:sequenceFlow id="Flow_escalation_fill_end" sourceRef="SubProcess_escalation_fill" targetRef="End_escalation_fill" />

  </bpmn:process>

  <!-- ============================================ -->
  <!-- BPMN DIAGRAM (visual layout)                  -->
  <!-- ============================================ -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_vyplata_avansu">

      <!-- Start Event -->
      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="282" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="133" y="325" width="75" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Gateway: check task -->
      <bpmndi:BPMNShape id="Gateway_check_task_di" bpmnElement="Gateway_check_task" isMarkerVisible="true">
        <dc:Bounds x="245" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="225" y="245" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Create main -->
      <bpmndi:BPMNShape id="Task_create_main_di" bpmnElement="Task_create_main">
        <dc:Bounds x="310" y="380" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Gateway: merge -->
      <bpmndi:BPMNShape id="Gateway_merge1_di" bpmnElement="Gateway_merge1" isMarkerVisible="true">
        <dc:Bounds x="465" y="275" width="50" height="50" />
      </bpmndi:BPMNShape>

      <!-- Service Task: Get employees -->
      <bpmndi:BPMNShape id="Task_get_employees_di" bpmnElement="Task_get_employees">
        <dc:Bounds x="570" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- User Task: Approve -->
      <bpmndi:BPMNShape id="Task_approve_di" bpmnElement="Task_approve">
        <dc:Bounds x="730" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Timer: Approve reminder (boundary) -->
      <bpmndi:BPMNShape id="Timer_approve_reminder_di" bpmnElement="Timer_approve_reminder">
        <dc:Bounds x="732" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="690" y="360" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Send reminder approve -->
      <bpmndi:BPMNShape id="Task_send_reminder_approve_di" bpmnElement="Task_send_reminder_approve">
        <dc:Bounds x="700" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: reminder approve -->
      <bpmndi:BPMNShape id="End_reminder_approve_di" bpmnElement="End_reminder_approve">
        <dc:Bounds x="652" y="432" width="36" height="36" />
      </bpmndi:BPMNShape>

      <!-- Timer: Approve deadline (boundary) -->
      <bpmndi:BPMNShape id="Timer_approve_deadline_di" bpmnElement="Timer_approve_deadline">
        <dc:Bounds x="812" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="840" y="360" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- SubProcess: Escalation approve -->
      <bpmndi:BPMNShape id="SubProcess_escalation_approve_di" bpmnElement="SubProcess_escalation_approve">
        <dc:Bounds x="870" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: escalation approve -->
      <bpmndi:BPMNShape id="End_escalation_approve_di" bpmnElement="End_escalation_approve">
        <dc:Bounds x="982" y="432" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="960" y="475" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Gateway: Approved -->
      <bpmndi:BPMNShape id="Gateway_approved_di" bpmnElement="Gateway_approved" isMarkerVisible="true">
        <dc:Bounds x="895" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="890" y="245" width="60" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- User Task: Adjust -->
      <bpmndi:BPMNShape id="Task_adjust_di" bpmnElement="Task_adjust">
        <dc:Bounds x="870" y="120" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Timer: Adjust reminder -->
      <bpmndi:BPMNShape id="Timer_adjust_reminder_di" bpmnElement="Timer_adjust_reminder">
        <dc:Bounds x="872" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="830" y="85" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Send reminder adjust -->
      <bpmndi:BPMNShape id="Task_send_reminder_adjust_di" bpmnElement="Task_send_reminder_adjust">
        <dc:Bounds x="840" y="10" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: reminder adjust -->
      <bpmndi:BPMNShape id="End_reminder_adjust_di" bpmnElement="End_reminder_adjust">
        <dc:Bounds x="792" y="32" width="36" height="36" />
      </bpmndi:BPMNShape>

      <!-- Timer: Adjust deadline -->
      <bpmndi:BPMNShape id="Timer_adjust_deadline_di" bpmnElement="Timer_adjust_deadline">
        <dc:Bounds x="952" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="990" y="85" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- SubProcess: Escalation adjust -->
      <bpmndi:BPMNShape id="SubProcess_escalation_adjust_di" bpmnElement="SubProcess_escalation_adjust">
        <dc:Bounds x="1010" y="10" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: escalation adjust -->
      <bpmndi:BPMNShape id="End_escalation_adjust_di" bpmnElement="End_escalation_adjust">
        <dc:Bounds x="1122" y="32" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1100" y="75" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Timer: Wait for payday -->
      <bpmndi:BPMNShape id="Timer_wait_payday_di" bpmnElement="Timer_wait_payday">
        <dc:Bounds x="1002" y="282" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="980" y="325" width="80" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- User Task: Fill data -->
      <bpmndi:BPMNShape id="Task_fill_data_di" bpmnElement="Task_fill_data">
        <dc:Bounds x="1100" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Timer: Fill reminder -->
      <bpmndi:BPMNShape id="Timer_fill_reminder_di" bpmnElement="Timer_fill_reminder">
        <dc:Bounds x="1102" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1060" y="360" width="72" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Send reminder fill -->
      <bpmndi:BPMNShape id="Task_send_reminder_fill_di" bpmnElement="Task_send_reminder_fill">
        <dc:Bounds x="1070" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: reminder fill -->
      <bpmndi:BPMNShape id="End_reminder_fill_di" bpmnElement="End_reminder_fill">
        <dc:Bounds x="1022" y="432" width="36" height="36" />
      </bpmndi:BPMNShape>

      <!-- Timer: Fill deadline -->
      <bpmndi:BPMNShape id="Timer_fill_deadline_di" bpmnElement="Timer_fill_deadline">
        <dc:Bounds x="1182" y="322" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1210" y="360" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- SubProcess: Escalation fill -->
      <bpmndi:BPMNShape id="SubProcess_escalation_fill_di" bpmnElement="SubProcess_escalation_fill">
        <dc:Bounds x="1240" y="410" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End: escalation fill -->
      <bpmndi:BPMNShape id="End_escalation_fill_di" bpmnElement="End_escalation_fill">
        <dc:Bounds x="1352" y="432" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1330" y="475" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Create statement -->
      <bpmndi:BPMNShape id="Task_create_statement_di" bpmnElement="Task_create_statement">
        <dc:Bounds x="1260" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Gateway: Has advances -->
      <bpmndi:BPMNShape id="Gateway_has_advances_di" bpmnElement="Gateway_has_advances" isMarkerVisible="true">
        <dc:Bounds x="1415" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1400" y="245" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- Service Task: Pay advance -->
      <bpmndi:BPMNShape id="Task_pay_advance_di" bpmnElement="Task_pay_advance">
        <dc:Bounds x="1520" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- Service Task: Create RKO -->
      <bpmndi:BPMNShape id="Task_create_rko_di" bpmnElement="Task_create_rko">
        <dc:Bounds x="1680" y="260" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>

      <!-- End Event: Done -->
      <bpmndi:BPMNShape id="EndEvent_done_di" bpmnElement="EndEvent_done">
        <dc:Bounds x="1842" y="282" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1815" y="325" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- End Event: No advances -->
      <bpmndi:BPMNShape id="EndEvent_no_advances_di" bpmnElement="EndEvent_no_advances">
        <dc:Bounds x="1422" y="382" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1395" y="425" width="90" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <!-- ============================================ -->
      <!-- SEQUENCE FLOW EDGES                          -->
      <!-- ============================================ -->

      <!-- Main flow -->
      <bpmndi:BPMNEdge id="Flow_start_to_gw1_di" bpmnElement="Flow_start_to_gw1">
        <di:waypoint x="188" y="300" />
        <di:waypoint x="245" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_gw1_to_create_task_di" bpmnElement="Flow_gw1_to_create_task">
        <di:waypoint x="270" y="325" />
        <di:waypoint x="270" y="420" />
        <di:waypoint x="310" y="420" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_gw1_skip_di" bpmnElement="Flow_gw1_skip">
        <di:waypoint x="295" y="300" />
        <di:waypoint x="465" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_create_to_merge_di" bpmnElement="Flow_create_to_merge">
        <di:waypoint x="410" y="420" />
        <di:waypoint x="490" y="420" />
        <di:waypoint x="490" y="325" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_merge1_to_get_employees_di" bpmnElement="Flow_merge1_to_get_employees">
        <di:waypoint x="515" y="300" />
        <di:waypoint x="570" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_get_emp_to_approve_di" bpmnElement="Flow_get_emp_to_approve">
        <di:waypoint x="670" y="300" />
        <di:waypoint x="730" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_approve_to_gw2_di" bpmnElement="Flow_approve_to_gw2">
        <di:waypoint x="830" y="300" />
        <di:waypoint x="895" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_approved_yes_di" bpmnElement="Flow_approved_yes">
        <di:waypoint x="945" y="300" />
        <di:waypoint x="1002" y="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="965" y="282" width="20" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_approved_no_di" bpmnElement="Flow_approved_no">
        <di:waypoint x="920" y="275" />
        <di:waypoint x="920" y="200" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="928" y="235" width="14" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_adjust_to_approve_di" bpmnElement="Flow_adjust_to_approve">
        <di:waypoint x="870" y="160" />
        <di:waypoint x="780" y="160" />
        <di:waypoint x="780" y="260" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_wait_to_fill_di" bpmnElement="Flow_wait_to_fill">
        <di:waypoint x="1038" y="300" />
        <di:waypoint x="1100" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_fill_to_create_statement_di" bpmnElement="Flow_fill_to_create_statement">
        <di:waypoint x="1200" y="300" />
        <di:waypoint x="1260" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_statement_to_gw3_di" bpmnElement="Flow_statement_to_gw3">
        <di:waypoint x="1360" y="300" />
        <di:waypoint x="1415" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_has_advances_di" bpmnElement="Flow_has_advances">
        <di:waypoint x="1465" y="300" />
        <di:waypoint x="1520" y="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1485" y="282" width="20" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_no_advances_di" bpmnElement="Flow_no_advances">
        <di:waypoint x="1440" y="325" />
        <di:waypoint x="1440" y="382" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1448" y="350" width="14" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_pay_to_rko_di" bpmnElement="Flow_pay_to_rko">
        <di:waypoint x="1620" y="300" />
        <di:waypoint x="1680" y="300" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_rko_to_end_di" bpmnElement="Flow_rko_to_end">
        <di:waypoint x="1780" y="300" />
        <di:waypoint x="1842" y="300" />
      </bpmndi:BPMNEdge>

      <!-- Reminder/escalation flows: Approve -->
      <bpmndi:BPMNEdge id="Flow_approve_reminder_di" bpmnElement="Flow_approve_reminder">
        <di:waypoint x="750" y="358" />
        <di:waypoint x="750" y="410" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_reminder_approve_end_di" bpmnElement="Flow_reminder_approve_end">
        <di:waypoint x="700" y="450" />
        <di:waypoint x="688" y="450" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_approve_deadline_di" bpmnElement="Flow_approve_deadline">
        <di:waypoint x="830" y="358" />
        <di:waypoint x="830" y="384" />
        <di:waypoint x="870" y="384" />
        <di:waypoint x="870" y="410" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_escalation_approve_end_di" bpmnElement="Flow_escalation_approve_end">
        <di:waypoint x="970" y="450" />
        <di:waypoint x="982" y="450" />
      </bpmndi:BPMNEdge>

      <!-- Reminder/escalation flows: Adjust -->
      <bpmndi:BPMNEdge id="Flow_adjust_reminder_di" bpmnElement="Flow_adjust_reminder">
        <di:waypoint x="890" y="102" />
        <di:waypoint x="890" y="90" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_reminder_adjust_end_di" bpmnElement="Flow_reminder_adjust_end">
        <di:waypoint x="840" y="50" />
        <di:waypoint x="828" y="50" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_adjust_deadline_di" bpmnElement="Flow_adjust_deadline">
        <di:waypoint x="970" y="102" />
        <di:waypoint x="970" y="50" />
        <di:waypoint x="1010" y="50" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_escalation_adjust_end_di" bpmnElement="Flow_escalation_adjust_end">
        <di:waypoint x="1110" y="50" />
        <di:waypoint x="1122" y="50" />
      </bpmndi:BPMNEdge>

      <!-- Reminder/escalation flows: Fill -->
      <bpmndi:BPMNEdge id="Flow_fill_reminder_di" bpmnElement="Flow_fill_reminder">
        <di:waypoint x="1120" y="358" />
        <di:waypoint x="1120" y="410" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_reminder_fill_end_di" bpmnElement="Flow_reminder_fill_end">
        <di:waypoint x="1070" y="450" />
        <di:waypoint x="1058" y="450" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_fill_deadline_di" bpmnElement="Flow_fill_deadline">
        <di:waypoint x="1200" y="358" />
        <di:waypoint x="1200" y="384" />
        <di:waypoint x="1240" y="384" />
        <di:waypoint x="1240" y="410" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="Flow_escalation_fill_end_di" bpmnElement="Flow_escalation_fill_end">
        <di:waypoint x="1340" y="450" />
        <di:waypoint x="1352" y="450" />
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
