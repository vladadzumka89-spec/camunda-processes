<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                  xmlns:zeebe="http://camunda.org/schema/zeebe/1.0"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  id="Definitions_feature"
                  targetNamespace="http://tut.ua/bpmn/feature-pipeline"
                  exporter="Claude Code"
                  exporterVersion="1.2">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FEATURE TO PRODUCTION ‚Äî –ì–æ–ª–æ–≤–Ω–∏–π –ø–∞–π–ø–ª–∞–π–Ω v2

       –°—Ç–∞—Ä—Ç: /start command
       –§—ñ–Ω—ñ—à: –§—ñ—á–∞ –Ω–∞ production (—î–¥–∏–Ω–∏–π –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π –∫—ñ–Ω–µ—Ü—å)

       –ü—Ä–∏–Ω—Ü–∏–ø: –∂–æ–¥–Ω–∞ –Ω–µ–≤–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à—É—î –ø—Ä–æ—Ü–µ—Å.
       –ö–æ–∂–µ–Ω failure path ‚Üí –ø—ñ–¥–∑–∞–¥–∞—á–∞ –≤ Odoo ‚Üí rework ‚Üí –Ω–æ–≤–∏–π PR.
       –ö–æ–∂–µ–Ω –ª—é–¥—Å—å–∫–∏–π –∫—Ä–æ–∫ ‚Üí –ø—ñ–¥–∑–∞–¥–∞—á–∞ –≤ Odoo.

       –¶–∏–∫–ª–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –∑–≤'—è–∑–∫—É:
         1. PR-Agent score < 7 ‚Üí –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 3 –¥–Ω—ñ ‚Üí —á–µ–∫–∞—î–º–æ PR update
         2. –ë—É–¥—å-—è–∫–∞ –Ω–µ–≤–¥–∞—á–∞ –ø—ñ—Å–ª—è merge ‚Üí –ø—ñ–¥–∑–∞–¥–∞—á–∞ + –∫–æ–º–µ–Ω—Ç–∞—Ä ‚Üí
            —á–µ–∫–∞—î–º–æ –Ω–æ–≤–∏–π PR ‚Üí –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª review/merge/deploy

       –í–∏–∫–ª–∏–∫–∞—î deploy-process —è–∫ call activity (staging —Ç–∞ production).
       Rollback ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π (deploy-process error subprocess + rollback job type).

       Job worker types:
         pr-agent-review, github-merge, github-create-pr,
         github-comment, send-notification, http-request-smart, rollback
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <bpmn:error id="Error_deploy_failed" name="Deploy Failed" errorCode="DEPLOY_FAILED" />

  <!-- Messages for process correlation -->
  <bpmn:message id="Message_pr_event" name="msg_pr_event">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=head_branch" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_pr_updated" name="msg_pr_updated">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=string(pr_number)" />
    </bpmn:extensionElements>
  </bpmn:message>

  <bpmn:process id="feature-to-production" name="Feature to Production" isExecutable="true">
    <bpmn:extensionElements>
      <zeebe:versionTag value="1.7" />
    </bpmn:extensionElements>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 0: /start ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ START: Manual (/start command) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:startEvent id="start_manual" name="–§—ñ—á–∞ —Ä–æ–∑–ø–æ—á–∞—Ç–∞ (/start)">
      <bpmn:documentation>–†–æ–∑—Ä–æ–±–Ω–∏–∫ –∑–∞–ø—É—Å–∫–∞—î /start –≤ Claude Code CLI.
Camunda REST API —Å—Ç–≤–æ—Ä—é—î —ñ–Ω—Å—Ç–∞–Ω—Å –ø—Ä–æ—Ü–µ—Å—É –∑ task_name, task_description, head_branch.</bpmn:documentation>
      <bpmn:outgoing>f_manual_to_odoo</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- ‚îÄ‚îÄ Service Task: –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–¥–∞—á—É –≤ Odoo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_create_odoo" name="–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–¥–∞—á—É –≤ Odoo">
      <bpmn:documentation>POST –Ω–∞ Odoo webhook ‚Äî —Å—Ç–≤–æ—Ä—é—î –±–∞—Ç—å–∫—ñ–≤—Å—å–∫—É –∑–∞–¥–∞—á—É (project.project).
Body: {name: task_name, description: task_description, create_process: true, _model: "project.project", _id: 252}</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: task_name, description: task_description, create_process: true, _model: &quot;project.project&quot;, _id: 252}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_manual_to_odoo</bpmn:incoming>
      <bpmn:outgoing>f_odoo_to_wait</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ Intermediate Catch: —á–µ–∫–∞—î–º–æ PR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:intermediateCatchEvent id="catch_pr_created" name="–ß–µ–∫–∞—î–º–æ PR">
      <bpmn:documentation>–ß–µ–∫–∞—î msg_pr_event –∑ correlation key = head_branch.
–ö–æ–ª–∏ PR —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–∞ —Ü—é –≥—ñ–ª–∫—É ‚Äî –ø—Ä–æ–¥–æ–≤–∂—É—î flow.</bpmn:documentation>
      <bpmn:incoming>f_odoo_to_wait</bpmn:incoming>
      <bpmn:outgoing>f_catch_to_review</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MsgDef_catch_pr" messageRef="Message_pr_event" />
    </bpmn:intermediateCatchEvent>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 1: CI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ PR-AGENT REVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_pr_agent" name="PR-Agent Review">
      <bpmn:documentation>–ó–∞–ø—É—Å–∫–∞—î PR-Agent (Docker/CLI) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ code review.
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Grok —á–µ—Ä–µ–∑ OpenRouter API.
–ü–µ—Ä–µ–≤—ñ—Ä—è—î: –±–µ–∑–ø–µ–∫–∞, –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, type hinting, —ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è tut_*.
Output: review_score, review_comment, has_critical_issues</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="pr-agent-review" retries="2" />
      </bpmn:extensionElements>
      <bpmn:incoming>f_catch_to_review</bpmn:incoming>
      <bpmn:incoming>f_wait_update_back</bpmn:incoming>
      <bpmn:incoming>f_rework_catch_to_review</bpmn:incoming>
      <bpmn:outgoing>f02</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ SCORE CHECK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:exclusiveGateway id="gw_score" name="Score ‚â• 7?" default="f_score_no">
      <bpmn:incoming>f02</bpmn:incoming>
      <bpmn:outgoing>f_score_yes</bpmn:outgoing>
      <bpmn:outgoing>f_score_no</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Score < 7 path: –∫–æ–º–µ–Ω—Ç–∞—Ä ‚Üí receive task (—á–µ–∫–∞—î–º–æ PR update) –∑ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è–º–∏ -->
    <bpmn:serviceTask id="task_cannot_merge" name="–ö–æ–º–µ–Ω—Ç–∞—Ä: –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è">
      <bpmn:documentation>–ü—É–±–ª—ñ–∫—É—î –∫–æ–º–µ–Ω—Ç–∞—Ä –Ω–∞ PR: "Auto-merge —Å–∫–∞—Å–æ–≤–∞–Ω–æ ‚Äî score &lt; 7 –∞–±–æ —î –∫—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏."</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="github-comment" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;‚ö†Ô∏è **Auto-merge —Å–∫–∞—Å–æ–≤–∞–Ω–æ** ‚Äî Score &quot; + string(review_score) + &quot;/10. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è –≤—ñ–¥ PR-Agent –≤–∏—â–µ.&quot;" target="comment_text" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_score_no</bpmn:incoming>
      <bpmn:outgoing>f_to_wait_pr</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- Receive Task: —á–µ–∫–∞—î–º–æ PR update (–∑–∞–º—ñ—Å—Ç—å EBG+timer) -->
    <bpmn:receiveTask id="recv_wait_pr_update" name="–ß–µ–∫–∞—î–º–æ PR update" messageRef="Message_pr_updated">
      <bpmn:documentation>–û—á—ñ–∫—É—î push –Ω–æ–≤–∏—Ö –∫–æ–º—ñ—Ç—ñ–≤ –≤ PR (GitHub webhook: pull_request synchronize).
–ö–æ—Ä–µ–ª—è—Ü—ñ—è –ø–æ pr_number. Non-interrupting timer –Ω–∞–≥–∞–¥—É—î –∫–æ–∂–Ω—ñ 3 –¥–Ω—ñ.</bpmn:documentation>
      <bpmn:incoming>f_to_wait_pr</bpmn:incoming>
      <bpmn:outgoing>f_wait_update_back</bpmn:outgoing>
    </bpmn:receiveTask>

    <!-- Non-interrupting boundary timer: –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 3 –¥–Ω—ñ -->
    <bpmn:boundaryEvent id="timer_pr_reminder" name="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (3 –¥–Ω—ñ)" cancelActivity="false" attachedToRef="recv_wait_pr_update">
      <bpmn:outgoing>f_pr_reminder</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_pr_reminder">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/P3D</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="task_send_pr_reminder" name="–ù–∞–≥–∞–¥–∞—Ç–∏: PR –ø–æ—Ç—Ä–µ–±—É—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;reminder&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: PR #&quot; + string(pr_number) + &quot; –ø–æ—Ç—Ä–µ–±—É—î –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è (score &lt; 7). –í–∏–ø—Ä–∞–≤—Ç–µ –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è PR-Agent.&quot;" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_pr_reminder</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ AUTO-MERGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_auto_merge" name="Auto-merge PR –≤ staging">
      <bpmn:documentation>gh pr merge --squash --auto
Squash merge PR –≤ staging branch.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="github-merge" retries="2" />
      </bpmn:extensionElements>
      <bpmn:incoming>f_score_yes</bpmn:incoming>
      <bpmn:outgoing>f03</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 2: CD STAGING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ DEPLOY STAGING (Call Activity) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:callActivity id="call_deploy_staging" name="Deploy to Staging">
      <bpmn:documentation>–í–∏–∫–ª–∏–∫–∞—î deploy-process –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ staging.
–ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ ‚Äî boundary error event ‚Üí rework loop.
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π rollback –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ deploy-process (error subprocess).</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:calledElement processId="deploy-process" propagateAllChildVariables="false" />
        <zeebe:ioMapping>
          <zeebe:input source="=staging_host" target="server_host" />
          <zeebe:input source="=staging_ssh_user" target="ssh_user" />
          <zeebe:input source="=&quot;staging&quot;" target="branch" />
          <zeebe:input source="=staging_db" target="db_name" />
          <zeebe:input source="=staging_container" target="container" />
          <zeebe:input source="=staging_repo_dir" target="repo_dir" />
          <zeebe:input source="=true" target="run_smoke_test" />
          <zeebe:input source="=&quot;full&quot;" target="test_mode" />
          <zeebe:input source="=process_instance_key" target="process_instance_key" />
          <zeebe:output source="=modules_updated" target="staging_modules" />
          <zeebe:output source="=smoke_passed" target="staging_smoke" />
          <zeebe:output source="=clickbot_passed" target="clickbot_passed" />
          <zeebe:output source="=clickbot_report" target="clickbot_report" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f03</bpmn:incoming>
      <bpmn:outgoing>f04</bpmn:outgoing>
    </bpmn:callActivity>

    <!-- Boundary error on deploy staging ‚Üí rework -->
    <bpmn:boundaryEvent id="evt_deploy_stg_error" name="Deploy failed" attachedToRef="call_deploy_staging">
      <bpmn:outgoing>f_deploy_fail</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorDef_deploy_stg" errorRef="Error_deploy_failed" />
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="task_notify_deploy_fail" name="–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏: deploy staging failed">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;deploy_failed&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ùå Deploy PR #&quot; + string(pr_number) + &quot; –Ω–∞ staging –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è.&quot;" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_deploy_fail</bpmn:incoming>
      <bpmn:outgoing>f_deploy_fail_to_rework</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ SUBTASK: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ staging ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_subtask_verify_staging" name="–ü—ñ–¥–∑–∞–¥–∞—á–∞: –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ staging">
      <bpmn:documentation>–°—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∑–∞–¥–∞—á—É –≤ Odoo –¥–ª—è —Ç–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞: –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ staging –ø—ñ—Å–ª—è deploy.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ staging: PR #&quot; + string(pr_number), description: &quot;PR –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ –Ω–∞ staging. Clickbot: &quot; + (if clickbot_passed then &quot;passed&quot; else &quot;failed&quot;) + &quot;. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f04</bpmn:incoming>
      <bpmn:outgoing>f_subtask_to_verify_staging</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 3: VERIFICATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ USER: VERIFY STAGING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:userTask id="user_verify_staging" name="–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ staging">
      <bpmn:documentation>–¢–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –Ω–∞ staging:
‚Äî –§—ñ—á–∞ –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ
‚Äî –ù–µ–º–∞—î —Ä–µ–≥—Ä–µ—Å—ñ–π
‚Äî Clickbot —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (—è–∫—â–æ failed ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É)

–§–æ—Ä–º–∞: staging URL, PR –æ–ø–∏—Å, clickbot –∑–≤—ñ—Ç.
–†—ñ—à–µ–Ω–Ω—è: Approve / Reject (–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä–µ–º)</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:assignmentDefinition candidateGroups="tech-specialist" />
        <zeebe:formDefinition formId="verify-staging-form" />
        <zeebe:taskSchedule dueDate="=now() + duration(&quot;P3D&quot;)" />
      </bpmn:extensionElements>
      <bpmn:incoming>f_subtask_to_verify_staging</bpmn:incoming>
      <bpmn:outgoing>f07</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Boundary: –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 4 –≥–æ–¥–∏–Ω–∏ -->
    <bpmn:boundaryEvent id="BE_rem_verify_staging" name="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (4 –≥–æ–¥)" cancelActivity="false" attachedToRef="user_verify_staging">
      <bpmn:outgoing>f_rem_verify_staging</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_rem_verify_staging">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT4H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_rem_verify_staging" name="‚ö†Ô∏è –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ staging">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;reminder&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ö†Ô∏è –ù–ê–ì–ê–î–£–í–ê–ù–ù–Ø: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ staging –¥–ª—è PR #&quot; + string(pr_number) + &quot;. –ó–∞–¥–∞—á–∞ –æ—á—ñ–∫—É—î –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É.&quot;" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_rem_verify_staging</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- Boundary: –¥–µ–¥–ª–∞–π–Ω 3 –¥–Ω—ñ ‚Üí –µ—Å–∫–∞–ª–∞—Ü—ñ—è –∫–µ—Ä—ñ–≤–Ω–∏–∫—É -->
    <bpmn:boundaryEvent id="BE_ded_verify_staging" name="–î–µ–¥–ª–∞–π–Ω (3 –¥–Ω—ñ)" cancelActivity="false" attachedToRef="user_verify_staging">
      <bpmn:outgoing>f_esc_verify_staging</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_ded_verify_staging">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P3D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_esc_verify_staging" name="üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: staging –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: staging –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –¥–ª—è PR #&quot; + string(pr_number), description: &quot;–ó–∞–¥–∞—á–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ staging –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ –ø—Ä–æ—Ç—è–≥–æ–º 3 –¥–Ω—ñ–≤. –ü–æ—Ç—Ä—ñ–±–Ω–µ –≤—Ç—Ä—É—á–∞–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_esc_verify_staging</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ STAGING OK? ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:exclusiveGateway id="gw_staging_ok" name="Staging OK?" default="f_staging_yes">
      <bpmn:incoming>f07</bpmn:incoming>
      <bpmn:outgoing>f_staging_yes</bpmn:outgoing>
      <bpmn:outgoing>f_staging_no</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Staging rejected path ‚Üí rework -->
    <bpmn:serviceTask id="task_request_rework" name="–ö–æ–º–µ–Ω—Ç–∞—Ä: staging –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ">
      <bpmn:documentation>–ü—É–±–ª—ñ–∫—É—î –∫–æ–º–µ–Ω—Ç–∞—Ä –Ω–∞ PR –∑ –æ–ø–∏—Å–æ–º –ø—Ä–æ–±–ª–µ–º –≤—ñ–¥ —Ç–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞.
"Staging –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ: [–ø—Ä–∏—á–∏–Ω–∞]. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–ø—Ä–∞–≤—Ç–µ."</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="github-comment" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;‚ö†Ô∏è **Staging –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ**: &quot; + (if rejection_reason != null then rejection_reason else &quot;&quot;) + &quot;\n–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–ø—Ä–∞–≤—Ç–µ —Ç–∞ –ø—É—à–Ω—ñ—Ç—å –∑–º—ñ–Ω–∏.&quot;" target="comment_text" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_staging_no</bpmn:incoming>
      <bpmn:outgoing>f_staging_reject_to_rework</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PHASE 4: PRODUCTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ CREATE PR TO MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_create_pr_main" name="–°—Ç–≤–æ—Ä–∏—Ç–∏ PR –≤ main">
      <bpmn:documentation>gh pr create --base main --head BRANCH
–°—Ç–≤–æ—Ä—é—î PR –∑ feature-–≥—ñ–ª–∫–∏ –≤ main.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="github-create-pr" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=head_branch" target="head_branch" />
          <zeebe:input source="=&quot;main&quot;" target="base_branch" />
          <zeebe:input source="=&quot;[production] &quot; + pr_title" target="pr_title" />
          <zeebe:input source="=repository" target="repository" />
          <zeebe:output source="=pr_url" target="main_pr_url" />
          <zeebe:output source="=pr_number" target="main_pr_number" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_staging_yes</bpmn:incoming>
      <bpmn:outgoing>f08</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ SUBTASK: Merge PR –≤ main (NEW) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_subtask_merge_main" name="–ü—ñ–¥–∑–∞–¥–∞—á–∞: merge PR –≤ main">
      <bpmn:documentation>–°—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∑–∞–¥–∞—á—É –≤ Odoo –¥–ª—è —Ç–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞: review —Ç–∞ merge PR –≤ main.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;Review —Ç–∞ merge PR –≤ main: &quot; + pr_title, description: &quot;Staging –ø—Ä–æ–π–¥–µ–Ω–æ. –ü–æ—Ç—Ä—ñ–±–µ–Ω review —Ç–∞ merge PR –≤ main.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f08</bpmn:incoming>
      <bpmn:outgoing>f_subtask_to_merge_main</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ USER: MERGE TO MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:userTask id="user_merge_main" name="Review —Ç–∞ merge PR –≤ main">
      <bpmn:documentation>–¢–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –ø–µ—Ä–µ–≥–ª—è–¥–∞—î PR —ñ –º–µ—Ä–∂–∏—Ç—å –≤ main —á–µ—Ä–µ–∑ GitHub.
PR URL –Ω–∞–¥–∞—î—Ç—å—Å—è —É —Ñ–æ—Ä–º—ñ.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:assignmentDefinition candidateGroups="tech-specialist" />
        <zeebe:formDefinition formId="merge-main-form" />
        <zeebe:taskSchedule dueDate="=now() + duration(&quot;P3D&quot;)" />
      </bpmn:extensionElements>
      <bpmn:incoming>f_subtask_to_merge_main</bpmn:incoming>
      <bpmn:outgoing>f09</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Boundary: –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 4 –≥–æ–¥–∏–Ω–∏ -->
    <bpmn:boundaryEvent id="BE_rem_merge_main" name="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (4 –≥–æ–¥)" cancelActivity="false" attachedToRef="user_merge_main">
      <bpmn:outgoing>f_rem_merge_main</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_rem_merge_main">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT4H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_rem_merge_main" name="‚ö†Ô∏è –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: merge PR –≤ main">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;reminder&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ö†Ô∏è –ù–ê–ì–ê–î–£–í–ê–ù–ù–Ø: PR –≤ main –æ—á—ñ–∫—É—î review —Ç–∞ merge. PR #&quot; + string(pr_number)" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_rem_merge_main</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- Boundary: –¥–µ–¥–ª–∞–π–Ω 3 –¥–Ω—ñ ‚Üí –µ—Å–∫–∞–ª–∞—Ü—ñ—è –∫–µ—Ä—ñ–≤–Ω–∏–∫—É -->
    <bpmn:boundaryEvent id="BE_ded_merge_main" name="–î–µ–¥–ª–∞–π–Ω (3 –¥–Ω—ñ)" cancelActivity="false" attachedToRef="user_merge_main">
      <bpmn:outgoing>f_esc_merge_main</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_ded_merge_main">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P3D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_esc_merge_main" name="üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: PR –≤ main –Ω–µ –∑–º–µ—Ä–∂–µ–Ω–æ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: PR –≤ main –Ω–µ –∑–º–µ—Ä–∂–µ–Ω–æ –¥–ª—è PR #&quot; + string(pr_number), description: &quot;Merge PR –≤ main –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –ø—Ä–æ—Ç—è–≥–æ–º 3 –¥–Ω—ñ–≤. –ü–æ—Ç—Ä—ñ–±–Ω–µ –≤—Ç—Ä—É—á–∞–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_esc_merge_main</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ DEPLOY PRODUCTION (Call Activity) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:callActivity id="call_deploy_prod" name="Deploy to Production">
      <bpmn:documentation>–í–∏–∫–ª–∏–∫–∞—î deploy-process –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ production.
–ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ ‚Äî boundary error event ‚Üí rework loop.
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π rollback –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ deploy-process (error subprocess).</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:calledElement processId="deploy-process" propagateAllChildVariables="false" />
        <zeebe:ioMapping>
          <zeebe:input source="=production_host" target="server_host" />
          <zeebe:input source="=production_ssh_user" target="ssh_user" />
          <zeebe:input source="=&quot;main&quot;" target="branch" />
          <zeebe:input source="=production_db" target="db_name" />
          <zeebe:input source="=production_container" target="container" />
          <zeebe:input source="=production_repo_dir" target="repo_dir" />
          <zeebe:input source="=true" target="run_smoke_test" />
          <zeebe:input source="=process_instance_key" target="process_instance_key" />
          <zeebe:output source="=modules_updated" target="prod_modules" />
          <zeebe:output source="=smoke_passed" target="prod_smoke" />
          <zeebe:output source="=old_commit" target="prod_old_commit" />
          <zeebe:output source="=new_commit" target="prod_new_commit" />
          <zeebe:output source="=clickbot_passed" target="prod_clickbot_passed" />
          <zeebe:output source="=clickbot_report" target="prod_clickbot_report" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f09</bpmn:incoming>
      <bpmn:outgoing>f10</bpmn:outgoing>
    </bpmn:callActivity>

    <!-- Boundary error on deploy production ‚Üí rework -->
    <bpmn:boundaryEvent id="evt_deploy_prod_error" name="Deploy failed" attachedToRef="call_deploy_prod">
      <bpmn:outgoing>f_deploy_prod_fail</bpmn:outgoing>
      <bpmn:errorEventDefinition id="ErrorDef_deploy_prod" errorRef="Error_deploy_failed" />
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="task_notify_prod_fail" name="–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏: deploy production failed">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;deploy_failed&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ùå Deploy –Ω–∞ production –ø—Ä–æ–≤–∞–ª–∏–≤—Å—è. Auto-rollback –≤–∏–∫–æ–Ω–∞–Ω–æ.\nPR #&quot; + string(pr_number)" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_deploy_prod_fail</bpmn:incoming>
      <bpmn:outgoing>f_prod_fail_to_rework</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ SUBTASK: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ production (NEW) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_subtask_verify_prod" name="–ü—ñ–¥–∑–∞–¥–∞—á–∞: –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ production">
      <bpmn:documentation>–°—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∑–∞–¥–∞—á—É –≤ Odoo –¥–ª—è —Ç–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞: –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ production –ø—ñ—Å–ª—è deploy.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ production: PR #&quot; + string(pr_number), description: &quot;PR –∑–∞–¥–µ–ø–ª–æ—î–Ω–æ –Ω–∞ production. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f10</bpmn:incoming>
      <bpmn:outgoing>f_subtask_to_verify_prod</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ USER: VERIFY PRODUCTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:userTask id="user_verify_prod" name="–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ production">
      <bpmn:documentation>–¢–µ—Ö—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ o.tut.ua —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î:
‚Äî –°–∞–π—Ç –ø—Ä–∞—Ü—é—î
‚Äî –§—ñ—á–∞ –∑–∞–¥–µ–ø–ª–æ—î–Ω–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ
‚Äî –ù–µ–º–∞—î —Ä–µ–≥—Ä–µ—Å—ñ–π
‚Äî tut_core –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–µ—à—É —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞ (–±—Ä–∞—É–∑–µ—Ä–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏—Å—å)

–†—ñ—à–µ–Ω–Ω—è: OK / Rollback (–∑ –ø—Ä–∏—á–∏–Ω–æ—é)</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:assignmentDefinition candidateGroups="tech-specialist" />
        <zeebe:formDefinition formId="verify-prod-form" />
        <zeebe:taskSchedule dueDate="=now() + duration(&quot;P1D&quot;)" />
      </bpmn:extensionElements>
      <bpmn:incoming>f_subtask_to_verify_prod</bpmn:incoming>
      <bpmn:outgoing>f11</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Boundary: –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 4 –≥–æ–¥–∏–Ω–∏ -->
    <bpmn:boundaryEvent id="BE_rem_verify_prod" name="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (4 –≥–æ–¥)" cancelActivity="false" attachedToRef="user_verify_prod">
      <bpmn:outgoing>f_rem_verify_prod</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_rem_verify_prod">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/PT4H</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_rem_verify_prod" name="‚ö†Ô∏è –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ production">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;reminder&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ö†Ô∏è –ù–ê–ì–ê–î–£–í–ê–ù–ù–Ø: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ production –¥–ª—è PR #&quot; + string(pr_number) + &quot;. –ó–∞–¥–∞—á–∞ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –æ—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.&quot;" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_rem_verify_prod</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- Boundary: –¥–µ–¥–ª–∞–π–Ω 1 –¥–µ–Ω—å ‚Üí –µ—Å–∫–∞–ª–∞—Ü—ñ—è –∫–µ—Ä—ñ–≤–Ω–∏–∫—É -->
    <bpmn:boundaryEvent id="BE_ded_verify_prod" name="–î–µ–¥–ª–∞–π–Ω (1 –¥–µ–Ω—å)" cancelActivity="false" attachedToRef="user_verify_prod">
      <bpmn:outgoing>f_esc_verify_prod</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_ded_verify_prod">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">P1D</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="ST_esc_verify_prod" name="üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: production –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="http-request-smart" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;POST&quot;" target="method" />
          <zeebe:input source="=&quot;https://o.tut.ua/web/hook/67f62d7c-2612-444c-baf3-ad409c769bbe&quot;" target="url" />
          <zeebe:input source="={&quot;Content-Type&quot;:&quot;application/json&quot;}" target="headers" />
          <zeebe:input source="={name: &quot;üî¥ –ï–°–ö–ê–õ–ê–¶–Ü–Ø: production –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –¥–ª—è PR #&quot; + string(pr_number), description: &quot;–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ production –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–∞ –ø—Ä–æ—Ç—è–≥–æ–º 1 –¥–Ω—è. –¢–ï–†–ú–Ü–ù–û–í–û –ø–æ—Ç—Ä—ñ–±–Ω–µ –≤—Ç—Ä—É—á–∞–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞.&quot;, _model: &quot;project.project&quot;, _id: 252, process_instance_key: process_instance_key}" target="body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_esc_verify_prod</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ PRODUCTION OK? ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:exclusiveGateway id="gw_prod_ok" name="Production OK?" default="f_prod_yes">
      <bpmn:incoming>f11</bpmn:incoming>
      <bpmn:outgoing>f_prod_yes</bpmn:outgoing>
      <bpmn:outgoing>f_prod_no</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Production rejected path ‚Äî rollback then rework -->
    <bpmn:serviceTask id="task_rollback_prod" name="Rollback production">
      <bpmn:documentation>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π rollback: git checkout –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∫–æ–º—ñ—Ç—É + docker compose up --force-recreate.
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î rollback job type –∑ deploy handler.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="rollback" retries="1" />
        <zeebe:ioMapping>
          <zeebe:input source="=production_host" target="server_host" />
          <zeebe:input source="=prod_old_commit" target="old_commit" />
          <zeebe:input source="=&quot;main&quot;" target="branch" />
          <zeebe:input source="=production_repo_dir" target="repo_dir" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_prod_no</bpmn:incoming>
      <bpmn:outgoing>f_rollback_notify</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="task_notify_rollback" name="–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏: rollback –≤–∏–∫–æ–Ω–∞–Ω–æ">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;rollback&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚ö†Ô∏è Production rollback –≤–∏–∫–æ–Ω–∞–Ω–æ –¥–ª—è PR #&quot; + string(pr_number) + &quot;.\n–ü—Ä–∏—á–∏–Ω–∞: &quot; + (if rollback_reason != null then rollback_reason else &quot;–≤—ñ–¥—Ö–∏–ª–µ–Ω–æ —Ç–µ—Ö—Å–ø–µ—Ü–æ–º&quot;)" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_rollback_notify</bpmn:incoming>
      <bpmn:outgoing>f_rollback_to_rework</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ END SUCCESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:endEvent id="evt_end_success" name="–§—ñ—á–∞ –Ω–∞ production">
      <bpmn:incoming>f_prod_yes</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHARED REWORK PATH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         –í—Å—ñ failure paths –ø—ñ—Å–ª—è merge —Å—Ö–æ–¥—è—Ç—å—Å—è —Å—é–¥–∏:
           1. Deploy staging failed ‚Üí notify ‚Üí subtask rework
           2. Staging rejected ‚Üí comment ‚Üí subtask rework
           3. Deploy production failed ‚Üí notify ‚Üí subtask rework
           4. Production rejected ‚Üí rollback ‚Üí notify ‚Üí subtask rework

         Rework path: subtask ‚Üí comment ‚Üí catch new PR ‚Üí back to PR-Agent
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ COMMENT: Rework needed ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:serviceTask id="task_comment_rework" name="–ö–æ–º–µ–Ω—Ç–∞—Ä: –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–æ–≤–∏–π PR">
      <bpmn:documentation>–ü—É–±–ª—ñ–∫—É—î –∫–æ–º–µ–Ω—Ç–∞—Ä –Ω–∞ GitHub –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π PR.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="github-comment" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;üîÑ –ü–æ—Ç—Ä—ñ–±–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π PR –∑ –≥—ñ–ª–∫–∏ `&quot; + head_branch + &quot;` –≤ staging –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è CI/CD.&quot;" target="comment_text" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_deploy_fail_to_rework</bpmn:incoming>
      <bpmn:incoming>f_staging_reject_to_rework</bpmn:incoming>
      <bpmn:incoming>f_prod_fail_to_rework</bpmn:incoming>
      <bpmn:incoming>f_rollback_to_rework</bpmn:incoming>
      <bpmn:outgoing>f_rework_comment_to_catch</bpmn:outgoing>
    </bpmn:serviceTask>

    <!-- ‚îÄ‚îÄ CATCH: –ß–µ–∫–∞—î–º–æ –Ω–æ–≤–∏–π PR (NEW) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:receiveTask id="catch_pr_rework" name="–ß–µ–∫–∞—î–º–æ –Ω–æ–≤–∏–π PR" messageRef="Message_pr_event">
      <bpmn:documentation>–ü—ñ—Å–ª—è squash merge –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π PR –∑–∞–∫—Ä–∏—Ç–∏–π.
–ß–µ–∫–∞—î–º–æ –ù–û–í–ò–ô PR —á–µ—Ä–µ–∑ msg_pr_event (correlation by head_branch).
Non-interrupting timer –Ω–∞–≥–∞–¥—É—î –∫–æ–∂–Ω—ñ 3 –¥–Ω—ñ.</bpmn:documentation>
      <bpmn:incoming>f_rework_comment_to_catch</bpmn:incoming>
      <bpmn:outgoing>f_rework_catch_to_review</bpmn:outgoing>
    </bpmn:receiveTask>

    <!-- Non-interrupting boundary timer: rework –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω—ñ 3 –¥–Ω—ñ -->
    <bpmn:boundaryEvent id="timer_rework_reminder" name="–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (3 –¥–Ω—ñ)" cancelActivity="false" attachedToRef="catch_pr_rework">
      <bpmn:outgoing>f_rework_reminder</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerDef_rework_reminder">
        <bpmn:timeCycle xsi:type="bpmn:tFormalExpression">R/P3D</bpmn:timeCycle>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>

    <bpmn:serviceTask id="task_send_rework_reminder" name="–ù–∞–≥–∞–¥–∞—Ç–∏: –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–æ–≤–∏–π PR">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="send-notification" retries="2" />
        <zeebe:ioMapping>
          <zeebe:input source="=&quot;reminder&quot;" target="notification_type" />
          <zeebe:input source="=&quot;‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: PR #&quot; + string(pr_number) + &quot; –ø–æ—Ç—Ä–µ–±—É—î –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π PR –∑ –≥—ñ–ª–∫–∏ &quot; + head_branch + &quot; –≤ staging.&quot;" target="message_body" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>f_rework_reminder</bpmn:incoming>
    </bpmn:serviceTask>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SEQUENCE FLOWS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- Phase 0: /start -->
    <bpmn:sequenceFlow id="f_manual_to_odoo" sourceRef="start_manual" targetRef="task_create_odoo" />
    <bpmn:sequenceFlow id="f_odoo_to_wait" sourceRef="task_create_odoo" targetRef="catch_pr_created" />
    <bpmn:sequenceFlow id="f_catch_to_review" sourceRef="catch_pr_created" targetRef="task_pr_agent" />

    <!-- Phase 1: CI -->
    <bpmn:sequenceFlow id="f02" sourceRef="task_pr_agent" targetRef="gw_score" />

    <!-- Score < 7 loop (with reminders) -->
    <bpmn:sequenceFlow id="f_score_no" name="&lt; 7" sourceRef="gw_score" targetRef="task_cannot_merge" />
    <bpmn:sequenceFlow id="f_to_wait_pr" sourceRef="task_cannot_merge" targetRef="recv_wait_pr_update" />
    <bpmn:sequenceFlow id="f_wait_update_back" sourceRef="recv_wait_pr_update" targetRef="task_pr_agent" />
    <bpmn:sequenceFlow id="f_pr_reminder" sourceRef="timer_pr_reminder" targetRef="task_send_pr_reminder" />

    <!-- Score >= 7 -->
    <bpmn:sequenceFlow id="f_score_yes" name="‚â• 7" sourceRef="gw_score" targetRef="task_auto_merge">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=review_score &gt;= 7 and has_critical_issues = false</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <!-- Phase 2: CD Staging -->
    <bpmn:sequenceFlow id="f03" sourceRef="task_auto_merge" targetRef="call_deploy_staging" />
    <bpmn:sequenceFlow id="f04" sourceRef="call_deploy_staging" targetRef="task_subtask_verify_staging" />
    <bpmn:sequenceFlow id="f_subtask_to_verify_staging" sourceRef="task_subtask_verify_staging" targetRef="user_verify_staging" />

    <!-- Deploy staging error ‚Üí rework -->
    <bpmn:sequenceFlow id="f_deploy_fail" sourceRef="evt_deploy_stg_error" targetRef="task_notify_deploy_fail" />
    <bpmn:sequenceFlow id="f_deploy_fail_to_rework" sourceRef="task_notify_deploy_fail" targetRef="task_comment_rework" />

    <!-- Phase 3: Verification -->
    <bpmn:sequenceFlow id="f07" sourceRef="user_verify_staging" targetRef="gw_staging_ok" />

    <!-- Staging rejected ‚Üí rework -->
    <bpmn:sequenceFlow id="f_staging_no" name="–ü—Ä–æ–±–ª–µ–º–∏" sourceRef="gw_staging_ok" targetRef="task_request_rework">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=staging_approved = false</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="f_staging_reject_to_rework" sourceRef="task_request_rework" targetRef="task_comment_rework" />

    <!-- Staging approved -->
    <bpmn:sequenceFlow id="f_staging_yes" name="OK" sourceRef="gw_staging_ok" targetRef="task_create_pr_main" />

    <!-- Phase 4: Production -->
    <bpmn:sequenceFlow id="f08" sourceRef="task_create_pr_main" targetRef="task_subtask_merge_main" />
    <bpmn:sequenceFlow id="f_subtask_to_merge_main" sourceRef="task_subtask_merge_main" targetRef="user_merge_main" />
    <bpmn:sequenceFlow id="f09" sourceRef="user_merge_main" targetRef="call_deploy_prod" />
    <bpmn:sequenceFlow id="f10" sourceRef="call_deploy_prod" targetRef="task_subtask_verify_prod" />
    <bpmn:sequenceFlow id="f_subtask_to_verify_prod" sourceRef="task_subtask_verify_prod" targetRef="user_verify_prod" />
    <bpmn:sequenceFlow id="f11" sourceRef="user_verify_prod" targetRef="gw_prod_ok" />

    <!-- Deploy production error ‚Üí rework -->
    <bpmn:sequenceFlow id="f_deploy_prod_fail" sourceRef="evt_deploy_prod_error" targetRef="task_notify_prod_fail" />
    <bpmn:sequenceFlow id="f_prod_fail_to_rework" sourceRef="task_notify_prod_fail" targetRef="task_comment_rework" />

    <!-- Production OK -->
    <bpmn:sequenceFlow id="f_prod_yes" name="OK" sourceRef="gw_prod_ok" targetRef="evt_end_success" />

    <!-- Production rejected ‚Üí rollback ‚Üí rework -->
    <bpmn:sequenceFlow id="f_prod_no" name="–ü—Ä–æ–±–ª–µ–º–∞" sourceRef="gw_prod_ok" targetRef="task_rollback_prod">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=prod_approved = false</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="f_rollback_notify" sourceRef="task_rollback_prod" targetRef="task_notify_rollback" />
    <bpmn:sequenceFlow id="f_rollback_to_rework" sourceRef="task_notify_rollback" targetRef="task_comment_rework" />

    <!-- Boundary event flows: user_verify_staging -->
    <bpmn:sequenceFlow id="f_rem_verify_staging" sourceRef="BE_rem_verify_staging" targetRef="ST_rem_verify_staging" />
    <bpmn:sequenceFlow id="f_esc_verify_staging" sourceRef="BE_ded_verify_staging" targetRef="ST_esc_verify_staging" />

    <!-- Boundary event flows: user_merge_main -->
    <bpmn:sequenceFlow id="f_rem_merge_main" sourceRef="BE_rem_merge_main" targetRef="ST_rem_merge_main" />
    <bpmn:sequenceFlow id="f_esc_merge_main" sourceRef="BE_ded_merge_main" targetRef="ST_esc_merge_main" />

    <!-- Boundary event flows: user_verify_prod -->
    <bpmn:sequenceFlow id="f_rem_verify_prod" sourceRef="BE_rem_verify_prod" targetRef="ST_rem_verify_prod" />
    <bpmn:sequenceFlow id="f_esc_verify_prod" sourceRef="BE_ded_verify_prod" targetRef="ST_esc_verify_prod" />

    <!-- Shared rework path -->
    <bpmn:sequenceFlow id="f_rework_comment_to_catch" sourceRef="task_comment_rework" targetRef="catch_pr_rework" />
    <bpmn:sequenceFlow id="f_rework_catch_to_review" sourceRef="catch_pr_rework" targetRef="task_pr_agent" />
    <bpmn:sequenceFlow id="f_rework_reminder" sourceRef="timer_rework_reminder" targetRef="task_send_rework_reminder" />

    <!-- ‚îÄ‚îÄ ERROR EVENT SUBPROCESS (Catch-all) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <bpmn:subProcess id="subprocess_error_pipeline" name="–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫" triggeredByEvent="true">
      <bpmn:startEvent id="evt_error_catch_pipeline" name="–ü–æ–º–∏–ª–∫–∞">
        <bpmn:outgoing>f_error_to_notify_pipeline</bpmn:outgoing>
        <bpmn:errorEventDefinition id="ErrorDef_catch_pipeline">
          <bpmn:extensionElements>
            <zeebe:errorEventDefinition errorCodeVariable="caught_error_code" errorMessageVariable="caught_error_message" />
          </bpmn:extensionElements>
        </bpmn:errorEventDefinition>
      </bpmn:startEvent>

      <bpmn:serviceTask id="ST_error_notify_pipeline" name="‚ùå –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–¥–∞—á—É –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –≤ Odoo">
        <bpmn:documentation>–°—Ç–≤–æ—Ä—é—î –ø—ñ–¥–∑–∞–¥–∞—á—É –≤ Odoo –ø—Ä–æ –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—É –ø–æ–º–∏–ª–∫—É –≤ CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ñ –∑ –¥–µ—Ç–∞–ª—è–º–∏.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="send-notification" retries="2" />
          <zeebe:ioMapping>
            <zeebe:input source="=&quot;pipeline_error&quot;" target="notification_type" />
            <zeebe:input source="=&quot;–ó–∞–¥–∞—á–∞: &quot; + (if is defined(task_name) and task_name != null then task_name else &quot;‚Äî&quot;) + &quot;\n–ì—ñ–ª–∫–∞: &quot; + (if is defined(head_branch) and head_branch != null then head_branch else &quot;‚Äî&quot;) + (if is defined(pr_number) and pr_number != null then &quot;\nPR: #&quot; + string(pr_number) else &quot;&quot;) + &quot;\n–ö–æ–¥ –ø–æ–º–∏–ª–∫–∏: &quot; + (if is defined(caught_error_code) and caught_error_code != null then caught_error_code else &quot;‚Äî&quot;) + &quot;\n–î–µ—Ç–∞–ª—ñ: &quot; + (if is defined(caught_error_message) and caught_error_message != null then caught_error_message else &quot;–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞&quot;)" target="message_body" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>f_error_to_notify_pipeline</bpmn:incoming>
        <bpmn:outgoing>f_notify_to_end_pipeline</bpmn:outgoing>
      </bpmn:serviceTask>

      <bpmn:endEvent id="evt_error_end_pipeline">
        <bpmn:incoming>f_notify_to_end_pipeline</bpmn:incoming>
      </bpmn:endEvent>

      <bpmn:sequenceFlow id="f_error_to_notify_pipeline" sourceRef="evt_error_catch_pipeline" targetRef="ST_error_notify_pipeline" />
      <bpmn:sequenceFlow id="f_notify_to_end_pipeline" sourceRef="ST_error_notify_pipeline" targetRef="evt_error_end_pipeline" />
    </bpmn:subProcess>

  </bpmn:process>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DIAGRAM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       Layout v3 ‚Äî clean, no overlaps:
         Score<7 loop: y=100 (above main)
         Main flow:    y=380 (single horizontal line, left-to-right)
         Failure paths: y=530 (below main)
         Rework path:   y=740 (shared bottom)
         Reminders:     y=840 (below rework)
       Width: ~3590px
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_feature">
    <bpmndi:BPMNPlane id="BPMNPlane_feature" bpmnElement="feature-to-production">

      <!-- ‚ïê‚ïê‚ïê MAIN FLOW (y=380) ‚ïê‚ïê‚ïê -->

      <bpmndi:BPMNShape id="start_manual_di" bpmnElement="start_manual">
        <dc:Bounds x="80" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_create_odoo_di" bpmnElement="task_create_odoo">
        <dc:Bounds x="180" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="catch_pr_created_di" bpmnElement="catch_pr_created">
        <dc:Bounds x="410" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_pr_agent_di" bpmnElement="task_pr_agent">
        <dc:Bounds x="520" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="gw_score_di" bpmnElement="gw_score" isMarkerVisible="true">
        <dc:Bounds x="760" y="355" width="50" height="50" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_auto_merge_di" bpmnElement="task_auto_merge">
        <dc:Bounds x="890" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="call_deploy_staging_di" bpmnElement="call_deploy_staging">
        <dc:Bounds x="1130" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="evt_deploy_stg_error_di" bpmnElement="evt_deploy_stg_error">
        <dc:Bounds x="1192" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_subtask_verify_staging_di" bpmnElement="task_subtask_verify_staging">
        <dc:Bounds x="1370" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="user_verify_staging_di" bpmnElement="user_verify_staging">
        <dc:Bounds x="1610" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="gw_staging_ok_di" bpmnElement="gw_staging_ok" isMarkerVisible="true">
        <dc:Bounds x="1850" y="355" width="50" height="50" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_create_pr_main_di" bpmnElement="task_create_pr_main">
        <dc:Bounds x="1980" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_subtask_merge_main_di" bpmnElement="task_subtask_merge_main">
        <dc:Bounds x="2220" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="user_merge_main_di" bpmnElement="user_merge_main">
        <dc:Bounds x="2460" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="call_deploy_prod_di" bpmnElement="call_deploy_prod">
        <dc:Bounds x="2700" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="evt_deploy_prod_error_di" bpmnElement="evt_deploy_prod_error">
        <dc:Bounds x="2762" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_subtask_verify_prod_di" bpmnElement="task_subtask_verify_prod">
        <dc:Bounds x="2940" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="user_verify_prod_di" bpmnElement="user_verify_prod">
        <dc:Bounds x="3180" y="340" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="gw_prod_ok_di" bpmnElement="gw_prod_ok" isMarkerVisible="true">
        <dc:Bounds x="3420" y="355" width="50" height="50" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="evt_end_success_di" bpmnElement="evt_end_success">
        <dc:Bounds x="3550" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>

      <!-- ‚ïê‚ïê‚ïê SCORE < 7 LOOP (y=100) ‚ïê‚ïê‚ïê -->

      <bpmndi:BPMNShape id="task_cannot_merge_di" bpmnElement="task_cannot_merge">
        <dc:Bounds x="760" y="60" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="recv_wait_pr_update_di" bpmnElement="recv_wait_pr_update">
        <dc:Bounds x="520" y="60" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="timer_pr_reminder_di" bpmnElement="timer_pr_reminder">
        <dc:Bounds x="652" y="122" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_send_pr_reminder_di" bpmnElement="task_send_pr_reminder">
        <dc:Bounds x="700" y="200" width="160" height="80" />
      </bpmndi:BPMNShape>

      <!-- ‚ïê‚ïê‚ïê BOUNDARY EVENTS: REMINDERS & ESCALATIONS ‚ïê‚ïê‚ïê -->
      <!-- Layout: reminder LEFT, escalation RIGHT ‚Äî side by side at y=500 -->

      <!-- user_verify_staging boundaries -->
      <bpmndi:BPMNShape id="BE_rem_verify_staging_di" bpmnElement="BE_rem_verify_staging">
        <dc:Bounds x="1630" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_rem_verify_staging_di" bpmnElement="ST_rem_verify_staging">
        <dc:Bounds x="1550" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BE_ded_verify_staging_di" bpmnElement="BE_ded_verify_staging">
        <dc:Bounds x="1730" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_esc_verify_staging_di" bpmnElement="ST_esc_verify_staging">
        <dc:Bounds x="1700" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>

      <!-- user_merge_main boundaries -->
      <bpmndi:BPMNShape id="BE_rem_merge_main_di" bpmnElement="BE_rem_merge_main">
        <dc:Bounds x="2480" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_rem_merge_main_di" bpmnElement="ST_rem_merge_main">
        <dc:Bounds x="2400" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BE_ded_merge_main_di" bpmnElement="BE_ded_merge_main">
        <dc:Bounds x="2580" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_esc_merge_main_di" bpmnElement="ST_esc_merge_main">
        <dc:Bounds x="2550" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>

      <!-- user_verify_prod boundaries -->
      <bpmndi:BPMNShape id="BE_rem_verify_prod_di" bpmnElement="BE_rem_verify_prod">
        <dc:Bounds x="3200" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_rem_verify_prod_di" bpmnElement="ST_rem_verify_prod">
        <dc:Bounds x="3120" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BE_ded_verify_prod_di" bpmnElement="BE_ded_verify_prod">
        <dc:Bounds x="3300" y="402" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_esc_verify_prod_di" bpmnElement="ST_esc_verify_prod">
        <dc:Bounds x="3270" y="500" width="120" height="60" />
      </bpmndi:BPMNShape>

      <!-- ‚ïê‚ïê‚ïê FAILURE PATHS (y=530) ‚ïê‚ïê‚ïê -->

      <bpmndi:BPMNShape id="task_notify_deploy_fail_di" bpmnElement="task_notify_deploy_fail">
        <dc:Bounds x="1130" y="490" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_request_rework_di" bpmnElement="task_request_rework">
        <dc:Bounds x="1850" y="490" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_notify_prod_fail_di" bpmnElement="task_notify_prod_fail">
        <dc:Bounds x="2700" y="490" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_rollback_prod_di" bpmnElement="task_rollback_prod">
        <dc:Bounds x="3420" y="490" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_notify_rollback_di" bpmnElement="task_notify_rollback">
        <dc:Bounds x="3420" y="620" width="160" height="80" />
      </bpmndi:BPMNShape>

      <!-- ‚ïê‚ïê‚ïê SHARED REWORK PATH (y=740) ‚ïê‚ïê‚ïê -->

      <bpmndi:BPMNShape id="task_comment_rework_di" bpmnElement="task_comment_rework">
        <dc:Bounds x="900" y="700" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="catch_pr_rework_di" bpmnElement="catch_pr_rework">
        <dc:Bounds x="600" y="700" width="160" height="80" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="timer_rework_reminder_di" bpmnElement="timer_rework_reminder">
        <dc:Bounds x="662" y="762" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="task_send_rework_reminder_di" bpmnElement="task_send_rework_reminder">
        <dc:Bounds x="600" y="840" width="160" height="80" />
      </bpmndi:BPMNShape>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDGES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

      <!-- Phase 0: /start ‚Üí Odoo ‚Üí Wait PR ‚Üí PR-Agent (horizontal) -->
      <bpmndi:BPMNEdge id="f_manual_to_odoo_di" bpmnElement="f_manual_to_odoo">
        <di:waypoint x="116" y="380" />
        <di:waypoint x="180" y="380" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="f_odoo_to_wait_di" bpmnElement="f_odoo_to_wait">
        <di:waypoint x="340" y="380" />
        <di:waypoint x="410" y="380" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="f_catch_to_review_di" bpmnElement="f_catch_to_review">
        <di:waypoint x="446" y="380" />
        <di:waypoint x="520" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Phase 1: CI -->
      <bpmndi:BPMNEdge id="f02_di" bpmnElement="f02">
        <di:waypoint x="680" y="380" />
        <di:waypoint x="760" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Score < 7: GW up ‚Üí Cannot Merge -->
      <bpmndi:BPMNEdge id="f_score_no_di" bpmnElement="f_score_no">
        <di:waypoint x="785" y="355" />
        <di:waypoint x="785" y="140" />
      </bpmndi:BPMNEdge>

      <!-- Cannot Merge ‚Üí Receive Task (left) -->
      <bpmndi:BPMNEdge id="f_to_wait_pr_di" bpmnElement="f_to_wait_pr">
        <di:waypoint x="760" y="100" />
        <di:waypoint x="680" y="100" />
      </bpmndi:BPMNEdge>

      <!-- Receive Task ‚Üí PR-Agent (down) -->
      <bpmndi:BPMNEdge id="f_wait_update_back_di" bpmnElement="f_wait_update_back">
        <di:waypoint x="600" y="140" />
        <di:waypoint x="600" y="340" />
      </bpmndi:BPMNEdge>

      <!-- Timer reminder ‚Üí Send PR reminder -->
      <bpmndi:BPMNEdge id="f_pr_reminder_di" bpmnElement="f_pr_reminder">
        <di:waypoint x="670" y="158" />
        <di:waypoint x="780" y="158" />
        <di:waypoint x="780" y="200" />
      </bpmndi:BPMNEdge>

      <!-- Score >= 7: GW ‚Üí Auto-merge (right) -->
      <bpmndi:BPMNEdge id="f_score_yes_di" bpmnElement="f_score_yes">
        <di:waypoint x="810" y="380" />
        <di:waypoint x="890" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Auto-merge ‚Üí Deploy Staging -->
      <bpmndi:BPMNEdge id="f03_di" bpmnElement="f03">
        <di:waypoint x="1050" y="380" />
        <di:waypoint x="1130" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Deploy Staging ‚Üí Subtask Verify Staging -->
      <bpmndi:BPMNEdge id="f04_di" bpmnElement="f04">
        <di:waypoint x="1290" y="380" />
        <di:waypoint x="1370" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Subtask ‚Üí Verify Staging -->
      <bpmndi:BPMNEdge id="f_subtask_to_verify_staging_di" bpmnElement="f_subtask_to_verify_staging">
        <di:waypoint x="1530" y="380" />
        <di:waypoint x="1610" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Boundary error ‚Üí Notify Deploy Fail (down) -->
      <bpmndi:BPMNEdge id="f_deploy_fail_di" bpmnElement="f_deploy_fail">
        <di:waypoint x="1210" y="438" />
        <di:waypoint x="1210" y="490" />
      </bpmndi:BPMNEdge>

      <!-- Notify Deploy Fail ‚Üí Comment Rework -->
      <bpmndi:BPMNEdge id="f_deploy_fail_to_rework_di" bpmnElement="f_deploy_fail_to_rework">
        <di:waypoint x="1210" y="570" />
        <di:waypoint x="1210" y="715" />
        <di:waypoint x="1060" y="715" />
      </bpmndi:BPMNEdge>

      <!-- Verify Staging ‚Üí GW Staging OK -->
      <bpmndi:BPMNEdge id="f07_di" bpmnElement="f07">
        <di:waypoint x="1770" y="380" />
        <di:waypoint x="1850" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Staging rejected: GW down ‚Üí Request Rework -->
      <bpmndi:BPMNEdge id="f_staging_no_di" bpmnElement="f_staging_no">
        <di:waypoint x="1875" y="405" />
        <di:waypoint x="1875" y="450" />
        <di:waypoint x="1930" y="450" />
        <di:waypoint x="1930" y="490" />
      </bpmndi:BPMNEdge>

      <!-- Request Rework ‚Üí Comment Rework -->
      <bpmndi:BPMNEdge id="f_staging_reject_to_rework_di" bpmnElement="f_staging_reject_to_rework">
        <di:waypoint x="1930" y="570" />
        <di:waypoint x="1930" y="730" />
        <di:waypoint x="1060" y="730" />
      </bpmndi:BPMNEdge>

      <!-- Staging OK: GW ‚Üí Create PR main -->
      <bpmndi:BPMNEdge id="f_staging_yes_di" bpmnElement="f_staging_yes">
        <di:waypoint x="1900" y="380" />
        <di:waypoint x="1980" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Create PR ‚Üí Subtask Merge main -->
      <bpmndi:BPMNEdge id="f08_di" bpmnElement="f08">
        <di:waypoint x="2140" y="380" />
        <di:waypoint x="2220" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Subtask ‚Üí Merge main -->
      <bpmndi:BPMNEdge id="f_subtask_to_merge_main_di" bpmnElement="f_subtask_to_merge_main">
        <di:waypoint x="2380" y="380" />
        <di:waypoint x="2460" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Merge main ‚Üí Deploy prod -->
      <bpmndi:BPMNEdge id="f09_di" bpmnElement="f09">
        <di:waypoint x="2620" y="380" />
        <di:waypoint x="2700" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Deploy prod ‚Üí Subtask Verify prod -->
      <bpmndi:BPMNEdge id="f10_di" bpmnElement="f10">
        <di:waypoint x="2860" y="380" />
        <di:waypoint x="2940" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Subtask ‚Üí Verify prod -->
      <bpmndi:BPMNEdge id="f_subtask_to_verify_prod_di" bpmnElement="f_subtask_to_verify_prod">
        <di:waypoint x="3100" y="380" />
        <di:waypoint x="3180" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Verify prod ‚Üí GW Prod OK -->
      <bpmndi:BPMNEdge id="f11_di" bpmnElement="f11">
        <di:waypoint x="3340" y="380" />
        <di:waypoint x="3420" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Boundary error ‚Üí Notify Prod Fail (down) -->
      <bpmndi:BPMNEdge id="f_deploy_prod_fail_di" bpmnElement="f_deploy_prod_fail">
        <di:waypoint x="2780" y="438" />
        <di:waypoint x="2780" y="490" />
      </bpmndi:BPMNEdge>

      <!-- Notify Prod Fail ‚Üí Comment Rework -->
      <bpmndi:BPMNEdge id="f_prod_fail_to_rework_di" bpmnElement="f_prod_fail_to_rework">
        <di:waypoint x="2780" y="570" />
        <di:waypoint x="2780" y="745" />
        <di:waypoint x="1060" y="745" />
      </bpmndi:BPMNEdge>

      <!-- Prod OK ‚Üí End Success -->
      <bpmndi:BPMNEdge id="f_prod_yes_di" bpmnElement="f_prod_yes">
        <di:waypoint x="3470" y="380" />
        <di:waypoint x="3550" y="380" />
      </bpmndi:BPMNEdge>

      <!-- Prod rejected: GW down ‚Üí Rollback -->
      <bpmndi:BPMNEdge id="f_prod_no_di" bpmnElement="f_prod_no">
        <di:waypoint x="3445" y="405" />
        <di:waypoint x="3445" y="450" />
        <di:waypoint x="3500" y="450" />
        <di:waypoint x="3500" y="490" />
      </bpmndi:BPMNEdge>

      <!-- Rollback ‚Üí Notify Rollback -->
      <bpmndi:BPMNEdge id="f_rollback_notify_di" bpmnElement="f_rollback_notify">
        <di:waypoint x="3500" y="570" />
        <di:waypoint x="3500" y="620" />
      </bpmndi:BPMNEdge>

      <!-- Notify Rollback ‚Üí Comment Rework -->
      <bpmndi:BPMNEdge id="f_rollback_to_rework_di" bpmnElement="f_rollback_to_rework">
        <di:waypoint x="3420" y="660" />
        <di:waypoint x="3420" y="760" />
        <di:waypoint x="1060" y="760" />
      </bpmndi:BPMNEdge>

      <!-- ‚ïê‚ïê‚ïê BOUNDARY EVENT EDGES ‚ïê‚ïê‚ïê -->

      <!-- user_verify_staging: reminder (down-left to left task) -->
      <bpmndi:BPMNEdge id="f_rem_verify_staging_di" bpmnElement="f_rem_verify_staging">
        <di:waypoint x="1648" y="438" />
        <di:waypoint x="1610" y="500" />
      </bpmndi:BPMNEdge>

      <!-- user_verify_staging: escalation (down-right to right task) -->
      <bpmndi:BPMNEdge id="f_esc_verify_staging_di" bpmnElement="f_esc_verify_staging">
        <di:waypoint x="1748" y="438" />
        <di:waypoint x="1760" y="500" />
      </bpmndi:BPMNEdge>

      <!-- user_merge_main: reminder -->
      <bpmndi:BPMNEdge id="f_rem_merge_main_di" bpmnElement="f_rem_merge_main">
        <di:waypoint x="2498" y="438" />
        <di:waypoint x="2460" y="500" />
      </bpmndi:BPMNEdge>

      <!-- user_merge_main: escalation -->
      <bpmndi:BPMNEdge id="f_esc_merge_main_di" bpmnElement="f_esc_merge_main">
        <di:waypoint x="2598" y="438" />
        <di:waypoint x="2610" y="500" />
      </bpmndi:BPMNEdge>

      <!-- user_verify_prod: reminder -->
      <bpmndi:BPMNEdge id="f_rem_verify_prod_di" bpmnElement="f_rem_verify_prod">
        <di:waypoint x="3218" y="438" />
        <di:waypoint x="3180" y="500" />
      </bpmndi:BPMNEdge>

      <!-- user_verify_prod: escalation -->
      <bpmndi:BPMNEdge id="f_esc_verify_prod_di" bpmnElement="f_esc_verify_prod">
        <di:waypoint x="3318" y="438" />
        <di:waypoint x="3330" y="500" />
      </bpmndi:BPMNEdge>

      <!-- Comment Rework ‚Üí Catch PR Rework (left) -->
      <bpmndi:BPMNEdge id="f_rework_comment_to_catch_di" bpmnElement="f_rework_comment_to_catch">
        <di:waypoint x="900" y="740" />
        <di:waypoint x="760" y="740" />
      </bpmndi:BPMNEdge>

      <!-- Catch PR Rework ‚Üí PR-Agent (up-left loop) -->
      <bpmndi:BPMNEdge id="f_rework_catch_to_review_di" bpmnElement="f_rework_catch_to_review">
        <di:waypoint x="600" y="740" />
        <di:waypoint x="460" y="740" />
        <di:waypoint x="460" y="400" />
        <di:waypoint x="520" y="400" />
      </bpmndi:BPMNEdge>

      <!-- Timer rework reminder ‚Üí Send Rework Reminder -->
      <bpmndi:BPMNEdge id="f_rework_reminder_di" bpmnElement="f_rework_reminder">
        <di:waypoint x="680" y="798" />
        <di:waypoint x="680" y="840" />
      </bpmndi:BPMNEdge>

      <!-- ‚ïê‚ïê‚ïê ERROR EVENT SUBPROCESS (y=960) ‚ïê‚ïê‚ïê -->

      <bpmndi:BPMNShape id="subprocess_error_pipeline_di" bpmnElement="subprocess_error_pipeline" isExpanded="true">
        <dc:Bounds x="170" y="960" width="500" height="120" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="evt_error_catch_pipeline_di" bpmnElement="evt_error_catch_pipeline">
        <dc:Bounds x="200" y="1002" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ST_error_notify_pipeline_di" bpmnElement="ST_error_notify_pipeline">
        <dc:Bounds x="290" y="980" width="200" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="evt_error_end_pipeline_di" bpmnElement="evt_error_end_pipeline">
        <dc:Bounds x="560" y="1002" width="36" height="36" />
      </bpmndi:BPMNShape>

      <!-- Error subprocess edges -->
      <bpmndi:BPMNEdge id="f_error_to_notify_pipeline_di" bpmnElement="f_error_to_notify_pipeline">
        <di:waypoint x="236" y="1020" />
        <di:waypoint x="290" y="1020" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="f_notify_to_end_pipeline_di" bpmnElement="f_notify_to_end_pipeline">
        <di:waypoint x="490" y="1020" />
        <di:waypoint x="560" y="1020" />
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions>
